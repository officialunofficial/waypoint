syntax = "proto3";

import "blocks.proto";

service ReplicationService {
  rpc GetShardSnapshotMetadata(GetShardSnapshotMetadataRequest) returns (GetShardSnapshotMetadataResponse);
  rpc GetShardTransactions(GetShardTransactionsRequest) returns (GetShardTransactionsResponse);

  // IMPORTANT: this is a temporary endpoint for debugging purposes only. It will eventually be
  // removed, and SHOULD NOT be used for production purposes.
  rpc GetReplicationTransactionsByFid(GetReplicationTransactionsByFidRequest)
    returns (GetReplicationTransactionsByFidResponse);
}

message GetShardSnapshotMetadataRequest {
  uint32 shard_id = 1;
}

message ShardSnapshotMetadata {
  uint32 shard_id = 1;
  uint64 height = 2;
  uint64 timestamp = 3;
}

message GetShardSnapshotMetadataResponse {
  repeated ShardSnapshotMetadata snapshots = 1;
}

message GetShardTransactionsRequest {
  uint32 shard_id = 1;
  uint64 height = 2;
  optional bytes page_token = 3;
}

message GetShardTransactionsResponse {
  repeated Transaction transactions = 1;
  optional bytes next_page_token = 2;
}

message GetReplicationTransactionsByFidRequest {
  uint64 fid = 2;
}

message GetReplicationTransactionsByFidResponse {
  Transaction transaction = 1;
}
